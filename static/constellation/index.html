<!DOCTYPE html>
<html lang='en' class='dark-mode'>
    <head>
        <meta charset='UTF-8'>
        <meta name='viewport' content='width=device-width, initial-scale=1.0'>
        <title>Constellation</title>
        <link rel='stylesheet' href='game.css'>
    </head>
    <body>
        <header>
            <h1>Constellation</h1>
            <nav>
                <ul>
                    <li id='fullscreen'>â›¶</li>
                    <li id='options' class='open-model'>âš™</li>
                    <li id='help' class='open-model'>?</li>
                </ul>
            </nav>
        </header>

        <main>
            <section>
                <p id='message'></p>
                <svg id='graph'></svg>
            </section>
            <nav>
                <ul>
                    <li id='new-game' class='open-model'>âœ¦ new</li>
                    <li id='reset'>ðŸ—‘ reset</li>
                    <li id='layout'>â™» layout</li>
                    <li id='hint' class='open-model'>ðŸ’¡hint</li>
                </ul>
            </nav>
            <section id='edge-container'>
                <h2>Available Connections</h2>
                <aside id='edges'></aside>
            </section>

        </main>

        <footer>
            <p>&copy; <a href='https://jordankasper.com'>Jordan Kasper</a> 2025</p>
            <p><a href='https://github.com/jakerella/jordankasper.com/tree/master/static/constellation'>the code</a></p>
        </footer>

        <div id='shield'></div>


        <!-- MODAL DIALOG SCREENS -->

        <dialog id='welcome-modal'>
            <button class='close close-icon'>X</button>
            <h2>Constellation</h2>

            <p>
                Constellation is a <strong>graph pattern matching game</strong>. Complete the 
                constellation by connecting stars (circles) using connections (lines). Each line has a 
                specific mass, and each star needs to have a specific <strong>number of connections</strong> 
                and a <strong>specific total mass</strong>.
            </p>
            <h3>To play:</h3>
            <ol>
                <li><strong>tap a connection</strong> in the "Available Connections" area at the 
                bottom,
                <li><strong>tap a star</strong> (circle) to start a connection,
                <li><strong>tap a second star</strong> to complete the connection!
            </ol>
            <p>
                Connect all of the stars with the correct number of connections and total mass to win.
            </p>
            <p>
                Remove a connection by tapping its line.
            </p>
            <p>If you need more help, click on the "?" icon in the top right!</p>

            <footer>
                <button class='close'>Close</button>
            </footer>
        </dialog>

        <dialog id='help-modal'>
            <button class='close close-icon'>X</button>
            <h2>Constellation</h2>

            <p>
                Constellation is a <strong>graph pattern matching game</strong>. You must complete the 
                constellation by connecting stars (circles) with connections (lines). Each line has a 
                specific mass, and each star needs to have a specific <strong>number of connections</strong> 
                with a <strong>specific total mass</strong>.
            </p>

            <h3>How to Play</h3>

            <ol>
                <li><strong>tap a connection</strong> in the "Available Connections" area at the 
                bottom,
                <li><strong>tap a star</strong> (circle) to start a connection,
                <li><strong>tap a second star</strong> to complete the connection.
            </ol>
            <p>You will see a new connection (a blue line) between the two stars!</p>
            <p>
                <strong>Remove a connection by tapping on a blue line</strong>, which will make it 
                available to select again.
            </p>
            <p>
                Repeat this process to connect all of the stars with the correct number of connections and total mass.
            </p>
            <p>
                A star will turn green when all of the connections into it are correct. (But note that there 
                are always multiple ways to connect stars!)
            </p>
            <p>
                Once the constellation is complete (that is, all stars have the correct number of connections
                and total mass), the game will show you the final score!
            </p>

            <h3>Game Details</h3>

            <p>
                Below is an example of a star. The label shows you the required mass and number of 
                connections required. In this example, the star requires a total mass of 10 through
                3 total connections. (The label is normally on the right, but may be on the left if 
                the star is near the right edge.)
            </p>

            <svg style='width: 95px; height: 40px;'>
                <circle cx='20' cy='20' r='14'></circle>
                <text class='node-label' x='39' y='25'>10 x 3</text>
            </svg>

            <p>
                Let's look at an example with multiple stars and a few connections:
            </p>

            <svg style='width: 250px; height: 150px;'>
                <line x1='20' y1='20' x2='220' y2='40' stroke-width='8' />
                <text class='edge-label' x='110' y='30'>4</text>
                <line x1='220' y1='40' x2='200' y2='110' stroke-width='6' />
                <text class='edge-label' x='200' y='80'>3</text>
                <line x1='200' y1='110' x2='100' y2='120' stroke-width='4' />
                <text class='edge-label' x='150' y='115'>2</text>

                <circle class='in-progress' cx='20' cy='20' r='14' />
                <text class='node-label' x='39' y='25'>9 x 3</text>
                <circle class='over' cx='220' cy='40' r='10' />
                <text class='node-label' x='168' y='45'>5 x 2</text>
                <circle cx='40' cy='80' r='6' />
                <text class='node-label' x='52' y='85'>3 x 1</text>
                <circle class='complete' cx='200' cy='110' r='10' />
                <text class='node-label' x='215' y='115'>5 x 2</text>
                <circle class='in-progress' cx='100' cy='120' r='12' />
                <text class='node-label' x='117' y='125'>6 x 2</text>
            </svg>

            <p>
                In the example above we see stars with diferent masses (indicated by both the 
                label and the size of the circle), number of required connections (indicated 
                in the label), and number of actual connections (the blue lines). The thickness
                of the line indicates the connection's mass (as does the red label).
            </p>
            <p>
                Notice that the "5x2" star
                <svg style='width:20px;height:20px;display:inline;margin:0;'><circle class='over' cx='10' cy='10' r='10' /></svg>
                in the top right is over its required mass: there are two connections coming in 
                (which is correct), but with a total mass of 7 instead of the required 5.
            </p>
            <p>
                On the other hand, the "5x2" star
                <svg style='width:20px;height:20px;display:inline;margin:0;'><circle class='complete' cx='10' cy='10' r='10' /></svg>
                in the bottom right is just right: there are two connections coming in 
                with a total mass of 5.
            </p>
            <p>
                Below is a table of the meaning of the various colors and shapes:
            </p>

            <table>
                <tr>
                    <td><svg style='width:33px;height:20px;'><text class='node-label' x='0' y='16'>8 x 3</text></svg></td>
                    <th>Star Info (Mass x Connections)</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><circle cx='10' cy='10' r='10' /></svg></td>
                    <th>Disconnected Star</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><circle class='central' cx='10' cy='10' r='8' /></svg></td>
                    <th>Central Star</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><circle class='outlier' cx='10' cy='10' r='6' /></svg></td>
                    <th>Outlier Star</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><circle class='in-progress' cx='10' cy='10' r='10' /></svg></td>
                    <th>Incomplete Star</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><circle class='over' cx='10' cy='10' r='10' /></svg></td>
                    <th>Over-connected Star</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><circle class='complete' cx='10' cy='10' r='10' /></svg></td>
                    <th>Complete Star</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><text class='edge-label' x='6' y='16'>3</text></svg></td>
                    <th>Connection Mass</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><line x1='0' y1='10' x2='20' y2='10' stroke-width='6' /></svg></td>
                    <th>Star Connection</th>
                </tr>
                <tr>
                    <td><svg style='width:20px;height:20px;'><line class='revealed' x1='0' y1='10' x2='20' y2='10' stroke-width='6' /></svg></td>
                    <th>Hint Connection</th>
                </tr>
            </table>

            <h3>Layout, Resets, and Hints</h3>

            <p>
                The constellations are <strong>randomly generated</strong>, which means they are often 
                oriented in a way that makes it difficult to see the circles and lines clearly. You 
                can always regenerate the layout by clicking on the "â™» layout" button.
            </p>

            <p>
                Remember that you can <strong>remove a connection by tapping on the blue line</strong>, 
                but sometimes you just want to start over. That's easy, just click on the "ðŸ—‘ reset"
                button to remove all of the edges.
            </p>
            <p><em>
                Note that you can't remove connections revealed by a hint!
            </em></p>

            <p>
                If you get stuck, you can ask for a hint by clicking on the "ðŸ’¡hint" button. This will
                reveal a correct connection. That connection might be one you already have in your 
                constellation, but now you will know that it was correct for sure!
            </p>
            <p><em>
                Note that there is a limit of <span class='max-hints'></span> hints available for any constellation and 
                <strong>you lose points each time you use a hint</strong>!
            </em></p>

            <p>
                Of course, if you get <em>really</em> stuck you can always start a completely new game 
                by clicking on the "âœ¦ new" button. You will lose any work on your current constellation!
            </p>

            <h3>Levels and Scoring</h3>

            <p>
                Here are the levels in Constellation:
            </p>
            <ol class='levels'></ol>
            
            <p>
                The level directly affects your maximum possible score. Here is how scores are calculated:
            </p>
            <ul>
                <li>Caclulate the starting value by multiplying the number of stars by number of connections.</li>
                <li>
                    Subtract points for any "central" stars, which are those that have a connection to 
                    every other star in the constellation.
                </li>
                <li>Subtract points for any "outlier" stars, which are those that only have a single connection</li>
                <li>Subtract points for any hints given.</li>
                <li>
                    Add points for constellation patterns that differ from the known correct solution 
                    (what we call "novel patterns").
                </li>
            </ul>

            <h3>Credits</h3>
            <p>
                Hi! My name is Jordan and I made this game. Why? I dunno... the idea popped into my head one 
                day while playing some other logic puzzles online, so I decided to build this one. I hope you 
                enjoy it! Feel free to check out <a href='http://jordankasper.com/games'>my other games</a>.
            </p>

            <footer>
                <button class='close'>Close</button>
            </footer>
        </dialog>

        <dialog id='options-modal'>
            <button class='close close-icon'>X</button>
            <h2>Game Options</h2>

            <label for='dark-mode'>
                <input type='checkbox' name='dark-mode' id='dark-mode'>
                Dark Mode
            </label>
        </dialog>

        <dialog id='win-modal'>
            <h2>Stellar!</h2>
            <p>You completed this constellation.</p>

            <table>
                <thead>
                    <tr><th><h3>Final Score:</h3></th><td class='final-score'></td></tr>
                </thead>
                <tr><th>Base Value:</th><td class='score-base'></td></tr>
                <tr><th>Novel Pattern:</th><td class='score-alternate'></td></tr>
                <tr><th>Central Stars:</th><td class='score-central'></td></tr>
                <tr><th>Outlier Stars:</th><td class='score-outlier'></td></tr>
                <tr><th>Hints Used:</th><td class='score-hints'></td></tr>
            </table>

            <p>How about trying a more difficult level?</p>
            <fieldset>
                <select name='new-level' class='level'></select>
                <button class='new-game'>New Game</button>
            </fieldset>
            <svg class='snapshot'></svg>
        </dialog>

        <dialog id='new-game-modal'>
            <h2>Are you sure?</h2>
            <p>You will be giving up this game, are you sure you want to start a new one?</p>
            <fieldset>
                <select name='new-level' class='level'></select>
                <button class='new-game'>New Game</button>
            </fieldset>
            <button class='close'>Cancel</button>
        </dialog>

        <dialog id='hint-modal'>
            <h2>Show Hint?</h2>
            <p>
                You can reveal up to <span class='max-hints'>?</span> connections.<br>
            </p>
            <p>
                Your final score will be 
                <strong>reduced by <span class='hint-point-deduction'>0</span> points</strong>
                when you solve this constellation!
            </p>
            <p><em>
                This may remove an existing connection in favor of the reveal,
                or it may only confirm one of your existing connections is correct.
            </em></p>
            <fieldset>
                <button class='close'>Cancel</button>
                <button class='show-hint'>Reveal</button>
            </fieldset>
        </dialog>


        <script type='module' src='game.js'></script>

        <script src='/js/vendor/fp.min.js'></script>
        <script src='/js/jk-send-hit.js'></script>
    </body>
</html>